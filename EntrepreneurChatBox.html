<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fund Nest</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="FundNest.css" />
  </head>
  <body>
    <div class="container">
<!-- NavBar -->
<div class="d-flex justify-content-between shadow-sm py-2">
  <!-- NavBar -->
  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
      <div class="d-flex gap-2">
        <img src="Images/logo.PNG" style="height: 2.5rem" />
        <a
          class="navbar-brand"
          href="index.html"
          style="font-size: x-large"
          >BRANDNEERS</a
        >
      </div>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <!-- Other nav items -->
          <li class="nav-item">
            <a
              class="nav-link fw-semibold"
              aria-current="page"
              href="index.html"
              >Home</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="#aboutFundnest"
              >About</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="#blogs">Blogs</a>
          </li>
          <li class="nav-item" id="courseSection" style="display: none">
            <a class="nav-link fw-semibold" href="Course.html">Courses</a>
          </li>
          <li class="nav-item" id="resourceSection" style="display: none">
            <a class="nav-link fw-semibold" href="Resources.html"
              >Resources</a
            >
          </li>
          <li
            class="nav-item"
            id="consultUsSection"
            style="display: none"
          >
            <a
              class="nav-link fw-semibold"
              href="Consultancy.html"
              id="consultLink"
              >ConsultUs</a
            >
          </li>
          <!-- Conditional nav items -->
          <li
            class="nav-item fw-semibold"
            id="entrepreneurIdea"
            style="display: none"
          >
            <a class="nav-link" href="EntrepreneurIdeas.html"
              >Entrepreneur Ideas</a
            >
          </li>
          <li
            class="nav-item fw-semibold"
            id="entrepreneurList"
            style="display: none"
          >
            <a class="nav-link" href="EntrepreneurPane.html"
              >Entrepreneur List</a
            >
          </li>
          <li
            class="nav-item fw-semibold"
            id="investorIdea"
            style="display: none"
          >
            <a class="nav-link" href="InvestorIdeas.html"
              >Investor Ideas</a
            >
          </li>
          <li
            class="nav-item fw-semibold"
            id="investorlist"
            style="display: none"
          >
            <a class="nav-link" href="InvestorPane.html">Investor List</a>
          </li>

          <buttton class="nav-item">
            <a
              class="nav-link rounded px-3 fw-semibold"
              style="
                margin-left: 28rem;
                background-color: rgba(0, 0, 0, 0.13);
              "
              id="loginLink"
              href="Login.html"
              >Login</a
            >
          </buttton>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Profile dropdown -->
  <div
    class="dropdown mt-4"
    style="margin-right: 1rem"
    id="profileDropdown"
  >
    <a
      href="#"
      class="d-flex align-items-center link-dark text-decoration-none"
      id="profileDropdown"
      data-bs-toggle="dropdown"
      aria-expanded="false"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="40"
        height="40"
        fill="currentColor"
        class="bi bi-person-circle"
        viewBox="0 0 16 16"
      >
        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
        <path
          fill-rule="evenodd"
          d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"
        />
      </svg>
    </a>
    <ul class="dropdown-menu text-small shadow">
      <li class="nav-item" id="investorprofile" style="display: none">
        <a class="nav-link" href="InvestorProfilePage.html"
          >Your Profile</a
        >
      </li>
      <li class="nav-item" id="entrepreneurprofile" style="display: none">
        <a class="nav-link" href="EntrepreneurProfilePage.html"
          >Your Profile</a
        >
      </li>
      <li><hr class="dropdown-divider" /></li>
      <li class="nav-item" id="mycourse" style="display: none">
        <a class="nav-link" href="Mycourse.html"
          >My Course</a
        >
      </li>

      <li><hr class="dropdown-divider" /></li>

      <li class="nav-item">
        <a class="nav-link" href="wallet.html"
          >Wallet</a
        >
      </li>
      <li><hr class="dropdown-divider" /></li>


      <li class="nav-item">
        <button class="nav-link" id="logoutLink" href="index.html">
          Log Out
        </button>
      </li>
    </ul>
  </div>
</div>

      <div class="d-flex flex-column" style="height: 100vh; padding: 1rem">
        <div class="d-flex align-items-center p-4 bg-light gap-4">
          <!-- <a href="" id="investorID"
            ><button class="mr-4 border-0 bg-light px-3">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                fill="currentColor"
                class="bi bi-arrow-left text-primary"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"
                />
              </svg></button
          ></a> -->
          <img
            class="rounded-circle"
            style="width: 5rem; height: 5rem"
            src="Images/Ellipse 1.png"
            alt="User Avatar"
          />
          <div class="ml-4">
            <h2 class="fw-semibold text-primary" id="investorName"></h2>
            <p class="text-muted small">Active Now</p>
          </div>
        </div>

        <div class="flex-grow-1 overflow-auto p-4">
          <!-- <div class="d-flex mb-4">
            <img
              class="rounded-circle"
              style="width: 4rem; height: 4rem"
              src="Images/Ellipse 1.png"
              alt="James Avatar"
            />
            <div class="ml-4">
              <div style="margin-left: 0.5rem; margin-top: 1rem">
                <p class="font-weight-bold text-primary">Sandy</p>
              </div>
              <div
                class="bg-white border border-primary px-3 py-1 rounded shadow-sm"
                style="
                  margin-top: 3rem;
                  margin-left: -3rem;
                  margin-right: auto;
                  max-width: 40rem;
                  width: 100%;
                  box-sizing: border-box;
                "
              >
                <p>
                  Lorem ipsum dolor sit amet. Aut dolorem corrupti aut quia enim
                  cum dignissimos nobis. Quo recusandae tempora est rerum ipsum
                  qui nostrum velit quo facere obcaecati ea quidem voluptatibus
                  et obcaecati ipsum!
                </p>
              </div>
            </div>
          </div> -->

          <div id="messageContainer">
            <!-- <div class="d-flex">
              <p class="text-right font-weight-bold text-primary" style="margin-right: 1rem; margin-top: 1rem">You</p>
              <img class="rounded-circle ml-4" style="width: 4rem; height: 4rem" src="Images/IMG_2025-1.jpg" alt="Your Avatar" />
            </div>
          </div> -->
        </div>

        <div class="d-flex align-items-center p-4 bg-light position-relative">
          <input
            type="text"
            class="flex-grow-1 form-control border-primary rounded-5"
            placeholder="Type your message here"
            style="height: 4rem"
            id="messageInput"
          />
          <button
            class="ml-4 border-0 position-absolute"
            style="right: 40px"
            id="sendButton"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="30"
              height="30"
              fill="currentColor"
              class="bi bi-send-arrow-up-fill text-primary"
              viewBox="0 0 16 16"
            >
              <path
                fill-rule="evenodd"
                d="M15.854.146a.5.5 0 0 1 .11.54L13.026 8.03A4.5 4.5 0 0 0 8 12.5c0 .5 0 1.5-.773.36l-1.59-2.498L.644 7.184l-.002-.001-.41-.261a.5.5 0 0 1 .083-.886l.452-.18.001-.001L15.314.035a.5.5 0 0 1 .54.111M6.637 10.07l7.494-7.494.471-1.178-1.178.471L5.93 9.363l.338.215a.5.5 0 0 1 .154.154z"
              />
              <path
                fill-rule="evenodd"
                d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.354-5.354a.5.5 0 0 0-.722.016l-1.149 1.25a.5.5 0 1 0 .737.676l.28-.305V14a.5.5 0 0 0 1 0v-1.793l.396.397a.5.5 0 0 0 .708-.708z"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

   
    <script>
      function updateNavbar() {
        const token = localStorage.getItem("token");
        const loginLink = document.getElementById("loginLink");
        const logoutLink = document.getElementById("logoutLink");
        const profileDropdown = document.getElementById("profileDropdown");

        if (token) {
          loginLink.style.display = "none";
          logoutLink.style.display = "block";
          profileDropdown.style.display = "block";
        } else {
          loginLink.style.display = "block";
          logoutLink.style.display = "none";
          profileDropdown.style.display = "none";
        }
      }

      async function updateUserNavigation(token) {
        try {
          const response = await axios.get("http://localhost:3000/check/role", {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.status === 200) {
            const userType = response.data.role;
            console.log("usertype:", userType);

            // Show the appropriate profile link
            const investorProfile = document.getElementById("investorprofile");
            const entrepreneurProfile = document.getElementById(
              "entrepreneurprofile"
            );

            console.log(userType === "entrepreneur");
            if (userType === "entrepreneur") {
              entrepreneurProfile.style.display = "block";
              investorProfile.style.display = "none";
              // document.getElementById("entrepreneurSection").style.display =
              //   "block";
              // document.getElementById("wallet1").innerText =`Wallet: (${response.data.wallet})`

              document.getElementById("mycourse").style.display = "block";

              // document.getElementById("investorSection").style.display = "none";
              // Hide Entrepreneur Ideas and Entrepreneur List from entrepreneurs
              document.getElementById("entrepreneurIdea").style.display =
                "none";
              document.getElementById("entrepreneurList").style.display =
                "none";

              // Show Investor Ideas and Investor List to entrepreneurs
              // document.getElementById("investorIdea").style.display = "block";
              document.getElementById("investorlist").style.display = "block";

              // Show the success section only to entrepreneurs
              // document.getElementById("sucessSection").style.display = "block";

              console.log("response");
              // Show Course, Resources, and ConsultUs sections for entrepreneurs
              document.getElementById("courseSection").style.display = "block";
              document.getElementById("resourceSection").style.display =
                "block";
              document.getElementById("consultUsSection").style.display =
                "block"; // Ensure ConsultUs is displayed
            } else if (userType === "investor") {
              investorProfile.style.display = "block";
              entrepreneurProfile.style.display = "none";
              document.getElementById("entrepreneurSection").style.display =
                "none";
              document.getElementById("investorSection").style.display =
                "block";

              // Show Entrepreneur Ideas and Entrepreneur List for investors
              document.getElementById("entrepreneurIdea").style.display =
                "block";
              document.getElementById("entrepreneurList").style.display =
                "block";

              // Hide Investor Ideas and Investor List from investors
              document.getElementById("investorIdea").style.display = "none";
              document.getElementById("investorlist").style.display = "none";

              // Hide Course, Resources, and ConsultUs sections from investors if needed
              document.getElementById("courseSection").style.display = "none";
              document.getElementById("resourceSection").style.display = "none";
              console.log("Course section");
              document.getElementById("consultUsSection").style.display =
                "none";
              // Hide the success section from investors
              document.getElementById("sucessSection").style.display = "none";
            } else {
              entrepreneurProfile.style.display = "none";
              investorProfile.style.display = "none";
              document.getElementById("entrepreneurSection").style.display =
                "none";
              document.getElementById("investorSection").style.display = "none";
            }
          } else {
            console.error("Failed to fetch user type:", response.statusText);
          }
        } catch (error) {
          console.error("Error:", error);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");

        updateNavbar();

        if (token) {
          updateUserNavigation(token);
        } else {
          // If no one is logged in, show the Consult Us section but disable the link
          document.getElementById("consultUsSection").style.display = "block";
          document.getElementById("consultLink").setAttribute("href", "#"); // Disable access without login
          document
            .getElementById("consultLink")
            .addEventListener("click", function (event) {
              event.preventDefault();
              alert("Please Log in");
              // open login page
              window.location.href = "login.html";
            });
        }
      });

      async function handleLogout() {
        try {
          const response = await axios.post(
            "http://localhost:3000/auth/logout"
          );
          alert(response.data.message);
          localStorage.removeItem("token");
          window.location.href = "index.html";
        } catch (error) {
          console.error("Logout error:", error);
          alert("Logout failed. Please try again.");
        }
      }

      document
        .getElementById("logoutLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Prevent default link behavior
          handleLogout(); // Call the logout function when link is clicked
        });
    </script>
    <script>
      // on clink consultsus open loagin

      document
        .getElementById("log1")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Prevent default link behavior
          window.location.href = "login.html"; // Redirect to login page
        });
    </script>

<script>



 // Get query parameters
 function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return Object.fromEntries(params.entries());
  }
  const params = getQueryParams();
    const receiverId = params.id;
    const entrepreneurId = localStorage.getItem("user");
    const roomId = receiverId + "" +  entrepreneurId;
    // console.log(roomId);


  // Fetch investor details from server
  async function fetchInvestorDetails() {
    try {
      const token = localStorage.getItem("token");
      if (!token) {
        console.error("Token not found");
        return;
      }

      const params = getQueryParams();
      const investorId = params.id;
      // console.log(investorId);
      const response = await axios.get(
        `http://localhost:3000/entrepreneur/investor/${investorId}`,
        {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        }
      );
      // console.log(response);

      if (response.status !== 200) {
        throw new Error(response.data.message || "Failed to fetch investor details");
      }

      const { investor } = response.data;
      // console.log(response.data);
      document.getElementById("investorName").textContent = investor.name;
      // document.getElementById("investorname").textContent = investor.name;
    } catch (error) {
      console.error("Error fetching investor details:", error.message);
      alert('Failed to fetch investor details. Please try again later.');
    }
  }

  // Event listener for the send button
  document.getElementById("sendButton").addEventListener("click", async () => {
    const messageInput = document.getElementById("messageInput");
    const message = messageInput.value.trim();
    
    const token = localStorage.getItem("token");
    if (!token) {
      console.error("Token not found");
      return;
    }

    
    if (!entrepreneurId) {
      console.error("Entrepreneur not found");
      return;
    }
    
    try {
      const response = await axios.post(
        ` http://localhost:3000/investor/send-message/${entrepreneurId}`,
        { message, receiverId, roomId },
        { headers: { Authorization: `Bearer ${token}` } }
      );

      if (response.status === 200) {
        messageInput.value = "";
        fetchMessages(); // Refresh messages after sending
      } else {
        alert(`Error: ${response.data.message}`);
      }
    } catch (error) {
      console.error("Error:", error);
      alert("An error occurred while sending the message.");
    }
  });


  // Function to fetch messages
  async function fetchMessages() {
    const params = getQueryParams();
    const investorId = params.id;

    const token = localStorage.getItem("token");
    if (!token) {
      console.error("Token not found");
      return;
    }

    try {
      const response = await axios.get(
        `http://localhost:3000/entrepreneur/${roomId}`,
        {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        }
      );

      if (response.status === 200) {
        displayMessages(response.data.messages);
      } else {
        console.error(`Error: ${response.data.message}`);
      }
    } catch (error) {
      console.error("Error fetching messages:", error);
    }
  }

  // Function to display messages
  function displayMessages(messages) {
    const messageContainer = document.getElementById("messageContainer");
    messageContainer.innerHTML = "";

    messages.forEach((message) => {
      const messageElement = `
        <div>
          <div class="d-flex ${message.senderId == entrepreneurId ? 'justify-content-end' : 'justify-content-start '} mb-4 ">
            <div style="margin-top: 5rem; max-width: 40rem">
              <div class=" ${message.senderId == entrepreneurId ? 'bg-dark' : 'bg-primary '} text-white px-3 py-1 rounded shadow-sm">
                <p>${message.message}</p>
              </div>
            </div>

        </div>`;

      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = messageElement;

      while (tempDiv.firstChild) {
        messageContainer.appendChild(tempDiv.firstChild);
      }
    });
  }


  // Fetch investor details and messages on page load
  window.onload = () => {
    fetchInvestorDetails();
    fetchMessages();
  };
</script>


  </body>
</html>
